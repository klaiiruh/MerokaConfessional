<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meroka Admin Portal - Physician Confessional</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Geist', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #18212d; color: #F7F5F2; min-height: 100vh; }
    
    .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-box { background: rgba(247,245,242,0.03); border: 1px solid rgba(247,245,242,0.08); border-radius: 16px; padding: 40px; width: 100%; max-width: 400px; }
    .login-box h1 { font-size: 24px; margin-bottom: 8px; font-weight: 700; letter-spacing: -0.02em; }
    .login-box p { color: #a8a29e; font-size: 14px; margin-bottom: 24px; }
    .login-logo { display: block; width: 120px; height: auto; margin: 0 auto 24px; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 6px; color: #a8a29e; }
    .form-group input { width: 100%; padding: 12px 14px; background: rgba(247,245,242,0.05); border: 1px solid rgba(247,245,242,0.1); border-radius: 8px; color: #F7F5F2; font-size: 14px; font-family: inherit; outline: none; transition: border-color 0.2s; }
    .form-group input:focus { border-color: #9b420f; }
    .form-group input::placeholder { color: #6b7280; }
    .login-btn { width: 100%; padding: 14px; background: #9b420f; border: none; border-radius: 8px; color: #fff; font-size: 14px; font-weight: 600; font-family: inherit; cursor: pointer; transition: all 0.2s; }
    .login-btn:hover { background: #b54d12; transform: translateY(-1px); }
    .login-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .error-msg { background: rgba(220,38,38,0.1); border: 1px solid rgba(220,38,38,0.3); color: #f87171; padding: 12px; border-radius: 8px; font-size: 13px; margin-bottom: 16px; display: none; }
    .error-msg.visible { display: block; }
    
    .google-btn { width: 100%; padding: 14px; background: #fff; border: 1px solid rgba(247,245,242,0.2); border-radius: 8px; color: #333; font-size: 14px; font-weight: 500; font-family: inherit; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .google-btn:hover { background: #f5f5f5; transform: translateY(-1px); }
    .google-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .dashboard { display: none; }
    .dashboard.visible { display: block; }
    .login-container.hidden { display: none; }
    
    header { padding: 16px 24px; border-bottom: 1px solid rgba(247,245,242,0.08); display: flex; justify-content: space-between; align-items: center; }
    .logo { font-weight: 600; font-size: 16px; display: flex; align-items: center; gap: 8px; }
    .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, #9b420f, #b54d12); border-radius: 6px; display: flex; align-items: center; justify-content: center; }
    .logo-icon svg { width: 18px; height: 18px; color: #fff; }
    .header-right { display: flex; align-items: center; gap: 12px; }
    .admin-email { font-size: 13px; color: #a8a29e; }
    .logout-btn { padding: 8px 14px; background: rgba(247,245,242,0.05); border: 1px solid rgba(247,245,242,0.12); border-radius: 6px; color: #F7F5F2; font-size: 13px; font-family: inherit; cursor: pointer; transition: all 0.2s; }
    .logout-btn:hover { background: rgba(220,38,38,0.2); border-color: rgba(220,38,38,0.4); }

    .main-content { max-width: 1200px; margin: 0 auto; padding: 24px; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .stat-card { background: rgba(247,245,242,0.03); border: 1px solid rgba(247,245,242,0.08); border-radius: 12px; padding: 20px; }
    .stat-card .label { font-size: 12px; color: #a8a29e; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px; }
    .stat-card .value { font-size: 32px; font-weight: 700; color: #9b420f; }
    .stat-card .subtext { font-size: 12px; color: #6b7280; margin-top: 4px; }

    .tabs { display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 1px solid rgba(247,245,242,0.08); padding-bottom: 16px; }
    .tab { padding: 10px 16px; background: transparent; border: 1px solid rgba(247,245,242,0.1); border-radius: 8px; color: #a8a29e; font-size: 13px; font-weight: 500; font-family: inherit; cursor: pointer; transition: all 0.2s; }
    .tab:hover { background: rgba(247,245,242,0.05); }
    .tab.active { background: #9b420f; border-color: #9b420f; color: #fff; }

    .confessions-list { display: flex; flex-direction: column; gap: 12px; }
    .confession-item { background: rgba(247,245,242,0.03); border: 1px solid rgba(247,245,242,0.08); border-radius: 12px; padding: 20px; transition: all 0.2s; }
    .confession-item:hover { border-color: rgba(247,245,242,0.15); }
    .confession-item.flagged { border-color: rgba(234,179,8,0.3); background: rgba(234,179,8,0.05); }
    .confession-text { font-size: 15px; line-height: 1.6; color: #d1ccc4; margin-bottom: 12px; }
    .confession-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 12px; color: #6b7280; margin-bottom: 12px; }
    .confession-meta span { display: flex; align-items: center; gap: 4px; }
    .confession-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .action-btn { padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; font-family: inherit; cursor: pointer; transition: all 0.2s; border: 1px solid; }
    .action-btn.flag { background: rgba(234,179,8,0.1); border-color: rgba(234,179,8,0.3); color: #fbbf24; }
    .action-btn.flag:hover { background: rgba(234,179,8,0.2); }
    .action-btn.flag.active { background: #fbbf24; color: #000; }
    .action-btn.delete { background: rgba(220,38,38,0.1); border-color: rgba(220,38,38,0.3); color: #f87171; }
    .action-btn.delete:hover { background: #dc2626; color: #fff; }
    .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    .chart-card { background: rgba(247,245,242,0.03); border: 1px solid rgba(247,245,242,0.08); border-radius: 12px; padding: 20px; }
    .chart-card h3 { font-size: 14px; font-weight: 600; margin-bottom: 16px; }
    .chart-bar { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .chart-bar .label { width: 120px; font-size: 12px; color: #a8a29e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .chart-bar .bar-container { flex: 1; height: 24px; background: rgba(247,245,242,0.05); border-radius: 4px; overflow: hidden; }
    .chart-bar .bar { height: 100%; background: linear-gradient(90deg, #9b420f, #b54d12); border-radius: 4px; transition: width 0.5s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; }
    .chart-bar .bar span { font-size: 11px; font-weight: 600; color: #fff; }

    .loading { text-align: center; padding: 40px; color: #a8a29e; }
    .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
    .empty-state h3 { font-size: 18px; margin-bottom: 8px; color: #a8a29e; }

    .tab-content { display: none; }
    .tab-content.visible { display: block; }
    
    .status-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-left: 8px; }
    .status-badge.flagged-badge { background: rgba(234,179,8,0.2); color: #fbbf24; }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(247,245,242,0.05); border-radius: 3px; }
    ::-webkit-scrollbar-thumb { background: rgba(155,66,15,0.5); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(155,66,15,0.8); }

    @media (max-width: 600px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .header-right { flex-direction: column; align-items: flex-end; gap: 8px; }
      .confession-actions { flex-wrap: wrap; }
    }
  </style>
</head>
<body>

  <div class="login-container" id="loginContainer">
    <div class="login-box">
      <img src="YOUR_LOGO_URL_HERE" alt="Meroka" class="login-logo">
      <h1>Meroka Admin Portal</h1>
      <p>Sign in to manage the Physician Confessional</p>
      <div class="error-msg" id="errorMsg"></div>
      <button class="google-btn" id="googleBtn">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Continue with Google
      </button>
    </div>
  </div>

  <div class="dashboard" id="dashboard">
    <header>
      <div class="logo">
        <div class="logo-icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
        </div>
        <span>Admin Portal</span>
      </div>
      <div class="header-right">
        <span class="admin-email" id="adminEmail"></span>
        <button class="logout-btn" id="logoutBtn">Sign Out</button>
      </div>
    </header>

    <div class="main-content">
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card">
          <div class="label">Total Confessions</div>
          <div class="value" id="statTotal">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Today</div>
          <div class="value" id="statToday">-</div>
        </div>
        <div class="stat-card">
          <div class="label">This Week</div>
          <div class="value" id="statWeek">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Flagged</div>
          <div class="value" id="statFlagged">-</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="confessions">All Confessions</button>
        <button class="tab" data-tab="flagged">Flagged</button>
        <button class="tab" data-tab="analytics">Analytics</button>
      </div>

      <div class="tab-content visible" id="confessionsTab">
        <div class="confessions-list" id="confessionsList"></div>
      </div>

      <div class="tab-content" id="flaggedTab">
        <div class="confessions-list" id="flaggedList"></div>
      </div>

      <div class="tab-content" id="analyticsTab">
        <div class="charts-grid">
          <div class="chart-card">
            <h3>By Specialty</h3>
            <div id="specialtyChart"></div>
          </div>
          <div class="chart-card">
            <h3>By State</h3>
            <div id="stateChart"></div>
          </div>
          <div class="chart-card">
            <h3>Top Keywords</h3>
            <div id="keywordChart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://hjomlxpovxgjweauiewt.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhqb21seHBvdnhnandlYXVpZXd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1ODQzMDUsImV4cCI6MjA4NDE2MDMwNX0.UcevzUHjnhikSQsHUuK4sfWM7ZFjVJ-X9pdaokUYmxo';
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const loginContainer = document.getElementById('loginContainer');
    const dashboard = document.getElementById('dashboard');
    const googleBtn = document.getElementById('googleBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const errorMsg = document.getElementById('errorMsg');
    const adminEmail = document.getElementById('adminEmail');

    // ============= AUTH =============
    async function signInWithGoogle() {
      googleBtn.disabled = true;
      googleBtn.innerHTML = '<span>Connecting...</span>';
      
      try {
        const { data, error } = await supabaseClient.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: "https://merokaconfessional.vercel.app/meroka-admin-7x9k2m",
            queryParams: {
              hd: 'meroka.com'
            }
          }
        });
        
        if (error) throw error;
      } catch (error) {
        showError(error.message);
        googleBtn.disabled = false;
        googleBtn.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Continue with Google';
      }
    }

    async function signOut() {
      await supabaseClient.auth.signOut();
      dashboard.classList.remove('visible');
      loginContainer.classList.remove('hidden');
      emailInput.value = '';
      passwordInput.value = '';
    }

    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.classList.add('visible');
      setTimeout(() => errorMsg.classList.remove('visible'), 5000);
    }

    async function checkSession() {
      const { data: { session } } = await supabaseClient.auth.getSession();
      if (session) {
        const userEmail = session.user.email;
        
        // Check if user is admin
        const { data: adminData, error: adminError } = await supabaseClient
          .from('admins')
          .select('email')
          .eq('email', userEmail)
          .single();
        
        if (adminData) {
          showDashboard(userEmail);
        } else {
          // User is authenticated but not an admin
          showError('You are not authorized as an admin. Contact your administrator.');
          await supabaseClient.auth.signOut();
        }
      }
    }

    function showDashboard(email) {
      loginContainer.classList.add('hidden');
      dashboard.classList.add('visible');
      adminEmail.textContent = email;
      loadStats();
      loadConfessions('all');
    }

    // ============= DATA LOADING =============
    async function loadStats() {
      try {
        const { data, error } = await supabaseClient.from('admin_stats').select('*').single();
        if (error) throw error;
        document.getElementById('statTotal').textContent = data.total_confessions || 0;
        document.getElementById('statToday').textContent = data.confessions_today || 0;
        document.getElementById('statWeek').textContent = data.confessions_this_week || 0;
        document.getElementById('statFlagged').textContent = data.flagged_count || 0;
      } catch (error) { console.error('Error loading stats:', error); }
    }

    async function loadConfessions(filter = 'all') {
      const listMap = { all: 'confessionsList', flagged: 'flaggedList', hidden: 'hiddenList' };
      const list = document.getElementById(listMap[filter]);
      if (!list) return;
      
      list.innerHTML = '<div class="loading">Loading...</div>';
      
      try {
        let query = supabaseClient.from('confessions').select('*').order('created_at', { ascending: false });
        
        if (filter === 'flagged') query = query.eq('is_flagged', true);
        if (filter === 'hidden') query = query.eq('is_hidden', true);
        
        const { data, error } = await query.limit(100);
        if (error) throw error;
        
        if (!data || data.length === 0) {
          const messages = {
            all: { title: 'No confessions yet', desc: 'Confessions will appear here' },
            flagged: { title: 'No flagged confessions', desc: 'Nothing has been flagged yet' },
            hidden: { title: 'No hidden confessions', desc: 'Nothing has been hidden yet' }
          };
          list.innerHTML = `<div class="empty-state"><h3>${messages[filter].title}</h3><p>${messages[filter].desc}</p></div>`;
          return;
        }
        
        list.innerHTML = data.map(c => renderConfessionCard(c)).join('');
        
        // Attach event listeners
        list.querySelectorAll('.action-btn').forEach(btn => {
          btn.addEventListener('click', handleAction);
        });
        
      } catch (error) {
        console.error('Error loading confessions:', error);
        list.innerHTML = `<div class="empty-state"><h3>Error loading</h3><p>${error.message}</p></div>`;
      }
    }

    function renderConfessionCard(c) {
      const hiddenClass = c.is_hidden ? 'is-hidden' : '';
      const flaggedClass = c.is_flagged ? 'flagged' : '';
      
      let badges = '';
      if (c.is_hidden) badges += '<span class="status-badge hidden-badge">HIDDEN</span>';
      if (c.is_flagged) badges += '<span class="status-badge flagged-badge">FLAGGED</span>';
      
      return `
        <div class="confession-item ${flaggedClass} ${hiddenClass}" data-id="${c.id}">
          <div class="confession-text">"${escapeHtml(c.confession_text)}"${badges}</div>
          <div class="confession-meta">
            <span>${c.specialty || 'No specialty'}</span>
            <span>•</span>
            <span>${c.state || 'No state'}</span>
            <span>•</span>
            <span>${c.years_independent || 'N/A'}</span>
            <span>•</span>
            <span>${formatDate(c.created_at)}</span>
          </div>
          <div class="confession-actions">
            <button class="action-btn flag ${c.is_flagged ? 'active' : ''}" data-action="flag" data-id="${c.id}" data-current="${c.is_flagged}">
              ${c.is_flagged ? 'Unflag' : 'Flag'}
            </button>
            <button class="action-btn delete" data-action="delete" data-id="${c.id}">
              Delete
            </button>
          </div>
        </div>
      `;
    }

    // ============= ACTIONS =============
    async function handleAction(e) {
      const btn = e.target;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      const current = btn.dataset.current === 'true';
      
      btn.disabled = true;
      
      try {
        if (action === 'flag') {
          await toggleFlag(id, !current);
        } else if (action === 'delete') {
          if (confirm('Are you sure you want to permanently delete this confession? This cannot be undone.')) {
            await deleteConfession(id);
          }
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
      
      btn.disabled = false;
    }

    async function toggleFlag(id, flagged) {
      console.log('Toggling flag:', id, flagged);
      
      const updateData = { 
        is_flagged: flagged, 
        flagged_at: flagged ? new Date().toISOString() : null 
      };
      
      const { data, error } = await supabaseClient
        .from('confessions')
        .update(updateData)
        .eq('id', id)
        .select();
      
      if (error) {
        console.error('Flag error:', error);
        throw error;
      }
      
      console.log('Flag result:', data);
      refreshAllLists();
    }

    async function deleteConfession(id) {
      console.log('Deleting:', id);
      
      // First delete related keyword_matches
      const { error: kwError } = await supabaseClient
        .from('keyword_matches')
        .delete()
        .eq('confession_id', id);
      
      if (kwError) {
        console.error('Keyword delete error:', kwError);
        // Continue anyway, might not have any matches
      }
      
      // Then delete the confession
      const { data, error } = await supabaseClient
        .from('confessions')
        .delete()
        .eq('id', id)
        .select();
      
      if (error) {
        console.error('Delete error:', error);
        throw error;
      }
      
      console.log('Delete result:', data);
      refreshAllLists();
    }

    function refreshAllLists() {
      console.log('Refreshing lists...');
      loadStats();
      const activeTab = document.querySelector('.tab.active');
      console.log('Active tab:', activeTab?.dataset?.tab);
      if (activeTab) {
        const tabName = activeTab.dataset.tab;
        if (tabName === 'confessions') loadConfessions('all');
        else if (tabName === 'flagged') loadConfessions('flagged');
        else if (tabName === 'analytics') loadAnalytics();
      } else {
        loadConfessions('all');
      }
    }

    // ============= ANALYTICS =============
    async function loadAnalytics() {
      try {
        const { data: specialtyData } = await supabaseClient.from('confessions_by_specialty').select('*').limit(8);
        if (specialtyData && specialtyData.length > 0) {
          const maxSpecialty = Math.max(...specialtyData.map(d => d.count));
          document.getElementById('specialtyChart').innerHTML = specialtyData.map(d => `
            <div class="chart-bar"><div class="label">${d.specialty}</div><div class="bar-container"><div class="bar" style="width: ${(d.count / maxSpecialty) * 100}%"><span>${d.count}</span></div></div></div>
          `).join('');
        }
      } catch (e) { console.error('Specialty chart error:', e); }
      
      try {
        const { data: stateData } = await supabaseClient.from('confessions_by_state').select('*').limit(8);
        if (stateData && stateData.length > 0) {
          const maxState = Math.max(...stateData.map(d => d.count));
          document.getElementById('stateChart').innerHTML = stateData.map(d => `
            <div class="chart-bar"><div class="label">${d.state}</div><div class="bar-container"><div class="bar" style="width: ${(d.count / maxState) * 100}%"><span>${d.count}</span></div></div></div>
          `).join('');
        }
      } catch (e) { console.error('State chart error:', e); }
      
      try {
        const { data: keywordData } = await supabaseClient.from('keyword_stats').select('*').limit(10);
        if (keywordData && keywordData.length > 0) {
          const maxKeyword = Math.max(...keywordData.map(d => d.total_count));
          document.getElementById('keywordChart').innerHTML = keywordData.map(d => `
            <div class="chart-bar"><div class="label">${d.keyword}</div><div class="bar-container"><div class="bar" style="width: ${(d.total_count / maxKeyword) * 100}%"><span>${d.total_count} (${d.percentage}%)</span></div></div></div>
          `).join('');
        }
      } catch (e) { console.error('Keyword chart error:', e); }
    }

    // ============= HELPERS =============
    function escapeHtml(text) { 
      const div = document.createElement('div'); 
      div.textContent = text; 
      return div.innerHTML; 
    }
    
    function formatDate(dateString) { 
      return new Date(dateString).toLocaleDateString('en-US', { 
        month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' 
      }); 
    }

    // ============= TABS =============
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('visible'));
        tab.classList.add('active');
        
        const tabName = tab.dataset.tab;
        document.getElementById(tabName + 'Tab').classList.add('visible');
        
        if (tabName === 'confessions') loadConfessions('all');
        else if (tabName === 'flagged') loadConfessions('flagged');
        else if (tabName === 'hidden') loadConfessions('hidden');
        else if (tabName === 'analytics') loadAnalytics();
      });
    });

    // ============= EVENT LISTENERS =============
    googleBtn.addEventListener('click', signInWithGoogle);
    logoutBtn.addEventListener('click', signOut);

    // Check session on load
    checkSession();
  </script>
</body>
</html>
